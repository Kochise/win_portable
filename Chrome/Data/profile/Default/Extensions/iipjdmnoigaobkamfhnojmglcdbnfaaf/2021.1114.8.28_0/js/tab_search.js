!function(){let tabList=[],helpVisible=!1,refreshingTabs=!1,isPremiumEnabled=!1,isTGSinstalled=!1;let hoverFocusTimer,closeOnEscape=!1,lastFilter="",filterTimeout=null;const IS_EXTENSION_URL=/^chrome\-extension/,IS_CF_TAB=RegExp(`^chrome-extension://${chrome.runtime.id}/`),FILTER_REMOVE_KEY_SUSPENDED_REGEX=RegExp("(^| )(-?is:suspended)( |$)","i"),FILTER_REMOVE_KEY_PINNED_REGEX=RegExp("(^| )(-?is:pinned)( |$)","i");let highlightedTabId=null;const TabActions=Object.freeze({DUPLICATE:"duplicate",ADD_TO_ALLOW_LIST:"allow_list",ADD_TO_ALLOW_LIST_DOMAIN:"allow_list_domain",SUSPEND:"suspend",UN_SUSPEND:"un_suspend",PIN:"pin",MOVE_WINDOW:"move_window",MOVE_TO_FIRST:"move_to_first",MOVE_TO_LAST:"move_to_last",LIST_DOMAIN_DUPLICATES:"list_domain_duplicates"}),urlParams=Utils.parseQuery(location.search.substr(1)),isAttached=urlParams&&urlParams.attached;let callingWindowId=Utils.parseQuery(location.search.replace(/^\??/,"")).currWindow,updateListTimeOut=null;async function updateDuplicateCount(){const duplicateCount=(await MessageSender.sendMessage({type:MessageType.GET_DUPLICATES_LIST})).filter((t=>t.isDuplicate)).length;$("#header_duplicate_count").text(duplicateCount>0?` (${duplicateCount})`:"")}async function getList(isFirst=!1){if(refreshingTabs&&!isFirst)return;refreshingTabs=!0;const innerTabList=[];if(!Settings.searchAllWindows&&callingWindowId){const thisWindow=await new Promise((resolve=>{chrome.windows.get(parseInt(callingWindowId),{populate:!0},resolve)}));return chrome.runtime.lastError||!thisWindow?(callingWindowId=void 0,window.history.replaceState("",document.title,location.href.replace(location.search,"")),refreshingTabs=!1,getList(isFirst)):(thisWindow.tabs.forEach((tab=>tab.url!==location.href&&innerTabList.push(tab))),sortTabList(innerTabList))}return(await new Promise((resolve=>{chrome.windows.getAll({populate:!0},resolve)}))).forEach((thisWindow=>thisWindow.tabs.forEach((tab=>tab.url!==location.href&&innerTabList.push(tab))))),sortTabList(innerTabList)}function sortTabList(list){return list.map((tab=>(tab.suspended=Suspender.isSuspended(tab.url),tab.icon=tab.favIconUrl||(IS_CF_TAB.test(tab.url)?Icon.CF_TAB:IS_EXTENSION_URL.test(tab.url)?Icon.EXTENSION_TAB:Icon.DEFAULT_TAB),tab.url=Utils.cleanUrl(tab.url),tab))).sort(((t1,t2)=>{let order=0;if(t1.windowId!=t2.windowId)if(callingWindowId){const cWindowId=parseInt(callingWindowId);order=t1.windowId==cWindowId?-1:t2.windowId==cWindowId?1:0}else order=t1.windowId-t2.windowId;return 0!=order?order:(order=t1.active&&!t2.active&&"chrome://newtab/"!==t1.url?-1:!t1.active&&t2.active&&"chrome://newtab/"!==t2.url?1:0,0!=order?order:(order=t1.pinned&&!t2.pinned?-1:!t1.pinned&&t2.pinned?1:0,0!=order||(order=t1.index-t2.index),order))}))}function updateListView(options={focusSearch:!1}){const listNodeString=tabList.reduce(((acc,tab)=>acc+toHtml(tab)),"");if($("#tab_host").text("").append(listNodeString),!1!==options.focusSearch&&$("#tabSearch").focus(),filterList(lastFilter),refreshingTabs=!1,null!=highlightedTabId){$(`.tab_item#${highlightedTabId}:visible`).length>0&&($(".tab_item").removeClass("highlighted"),$(".tab_item#"+highlightedTabId).addClass("highlighted"))}}$((async()=>{helpVisible=PopupCore.showHelp(helpVisible),await Settings.init(),updateControlListButtonTitles(),await updateSuspendButtonTitles(),await async function(){await Suspender.sendMessage(),isTGSinstalled=!chrome.runtime.lastError,$(".requiresTGS")[isTGSinstalled?"show":"hide"]()}();const tL=await getList(!0);tabList=tL.concat(),updateListView({focusSearch:!0}),updateDuplicateCount(),$("main").on({click:e=>{const tabId=parseInt(e.currentTarget.id);$(`#${tabId}`).hasClass("highlighted")||navigateToHovered(),e.target.classList.contains("tab_item_active_action_item")||(e.preventDefault(),e.stopImmediatePropagation(),e.target.classList.contains("tab_item_action_delete")?closeTab():switchToHighlightedTab())},mouseenter:()=>navigateToHovered()},".tab_item"),$("main").on("click",".tab_item_active_action_item",executeTabAction),$("#tabSearch").on({focus:()=>showSearchLabel(),blur:()=>showSearchLabel(),"input propertychange paste":()=>{showSearchLabel();const filterText=$("#tabSearch").val().toString();filterText!=lastFilter&&(lastFilter=filterText,filterTimeout&&clearTimeout(filterTimeout),filterTimeout=setTimeout(filterList,300,filterText))}}),$("a#keyboard_help").on("click",(e=>{helpVisible=PopupCore.showHelp(!0),e.preventDefault()})),$("div#copy_urls").on("click",(async()=>{const textFormat=Settings.copyUrlsFormat,visibleTabs=filterTabList(lastFilter,tabList,{premiumEnabled:isPremiumEnabled}).map((tab=>{switch(textFormat){case CopyUrlsFormat.URLS_ONLY:return tab.url;case CopyUrlsFormat.TEXT:return`${tab.title} (${tab.url})`;case CopyUrlsFormat.MARKDOWN:return`- [${tab.title}](${tab.url})`}})).join("\n");try{await navigator.clipboard.writeText(visibleTabs)}catch(error){return void Toast.showToast({text:chrome.i18n.getMessage("toast_text_error_copying_tabs_to_clipboard",error+"")})}Toast.showToast({text:chrome.i18n.getMessage("toast_text_tabs_copied_to_clipboard")})})),$(document).keydown((e=>{if(closeOnEscape&&e.which!=KEYCODE.ESCAPE)return closeOnEscape=!1,Toast.clear({speed:"fast"}),e.preventDefault(),void e.stopImmediatePropagation();if(e.ctrlKey||e.altKey||e.metaKey)return;if(helpVisible)return e.preventDefault(),void(helpVisible=PopupCore.showHelp(!1));const isInFilterInput=$("#tabSearch").is(":focus");switch(e.which){case KEYCODE.UP:e.preventDefault(),navigateTabList(KeyboardTraverse.UP);break;case KEYCODE.DOWN:e.preventDefault(),navigateTabList(KeyboardTraverse.DOWN);break;case KEYCODE.PAGEUP:e.preventDefault(),navigateTabListByPage(KeyboardTraverse.UP);break;case KEYCODE.PAGEDOWN:e.preventDefault(),navigateTabListByPage(KeyboardTraverse.DOWN);break;case KEYCODE.HOME:if(isInFilterInput)return;e.preventDefault(),e.stopImmediatePropagation(),navigateTabList(KeyboardTraverse.UP,!0);break;case KEYCODE.END:if(isInFilterInput)return;e.preventDefault(),e.stopImmediatePropagation(),navigateTabList(KeyboardTraverse.DOWN,!0);break;case KEYCODE.ENTER:if(isInFilterInput)return;e.preventDefault(),switchToHighlightedTab();break;case KEYCODE.ESCAPE:e.preventDefault(),$(".tab_item.highlighted").length>0?($(".tab_item.highlighted").removeClass("highlighted"),highlightNavigated({focusSearch:!0}),closeOnEscape=!1):""!==$("#tabSearch").val()?($("#tabSearch").val(""),showSearchLabel(),lastFilter="",filterList(lastFilter),closeOnEscape=!1):closeOnEscape?window.close():(Toast.showToast({text:chrome.i18n.getMessage("toast_text_press_escape_again_to_close"),duration:Toast.DURATION.INDEFINITE}),closeOnEscape=!0);break;case KEYCODE.DELETE:if(isInFilterInput)return;e.preventDefault(),closeTab();break;case KEYCODE.F1:e.preventDefault(),helpVisible=PopupCore.showHelp(!0)}})),$(document).keypress((e=>{if(e.ctrlKey||e.metaKey)return;if(helpVisible)return e.preventDefault(),void(helpVisible=PopupCore.showHelp(!1));if($("#tabSearch").is(":focus"))return;const character=e.key.toUpperCase();switch(character){case"?":e.preventDefault(),helpVisible=PopupCore.showHelp(!0);break;case"/":e.preventDefault(),$(".tab_item.highlighted").removeClass("highlighted"),highlightNavigated({focusSearch:!0});break;case"S":{e.preventDefault();const tabId=$(".tab_item.highlighted").data("id");tabId&&suspendTab(tabId);break}case"U":{e.preventDefault();const tabId=$(".tab_item.highlighted").data("id");tabId&&unsuspendTab(tabId);break}case"P":{e.preventDefault();const highlightedTabElement=$(".tab_item.highlighted")[0];if(!highlightedTabElement)return;const pinned=highlightedTabElement.dataset.pinned,tabId=highlightedTabElement.dataset.id;tabId&&null!=pinned&&togglePinTab(tabId,"true"===pinned);break}default:console.debug("Unused keyboard shortcut",character)}}));const filterText=urlParams[KEY_TAB_SEARCH_FILTER_TEXT];filterText&&setFilterText(filterText)})),chrome.storage.onChanged.addListener((async changes=>{await Settings.onChanged(changes),changes.hasOwnProperty("listControlMode")&&(updateControlListButtonTitles(),updateListView()),changes.hasOwnProperty("premiumState")&&(updateSuspendButtonTitles(),updateListView())})),chrome.runtime.onMessage.addListener((async message=>{if(message&&message.type)switch(message.type){case MessageType.UPDATE_DUPLICATES:updateDuplicateCount();break;case MessageType.TAB_REMOVED:{const removedTabIds=message.content.tabIds||[];if(0==removedTabIds.length||refreshingTabs)return;refreshingTabs=!0,removeTabsFromViewList(removedTabIds),tabList=tabList.filter((t=>!removedTabIds.includes(t.id))),refreshingTabs=!1,setTimeout(updateTabCount,500);break}case MessageType.TAB_UPDATED:{const updatedTabId=message.content.tabId;if(message.content.changeType==TabChangeType.OTHERS)return;if(refreshingTabs)return;const onUpdated=async(tabId,newTabId)=>{const list=await getList();updateListTimeOut=null;const searchForTabId=newTabId||tabId,newIndex=list.findIndex((t=>t.id==searchForTabId));if(-1==newIndex)return console.debug("New tab not found."),void(refreshingTabs=!1);const tab=list[newIndex];$(`#${tabId}.tab_item`).replaceWith(toHtml(tab)),tabList=list.concat(),filterItem(lastFilter,tab),refreshingTabs=!1,setTimeout(updateTabCount,500)};null!=updateListTimeOut&&clearTimeout(updateListTimeOut),updateListTimeOut=setTimeout(onUpdated,1e3,updatedTabId,message.content.newTabId);break}case MessageType.TAB_ADDED:{const newTabId=message.content.tabId;if(refreshingTabs)return;const list=await getList(),index=list.findIndex((t=>t.id==newTabId));if(-1==index)return void(refreshingTabs=!1);const tab=list[index];index==tabList.length?$("#tab_host").append(toHtml(tab)):$("#tab_host .tab_item").eq(index).before(toHtml(tab)),tabList=list.concat(),filterItem(lastFilter,tab),refreshingTabs=!1,setTimeout(updateTabCount,500);break}}}));const titleTabPinnedTab=chrome.i18n.getMessage("title_tab_pinned_tab"),titleButtonCloseTab=chrome.i18n.getMessage("title_button_close_tab"),titleButtonDuplicateTab=chrome.i18n.getMessage("title_button_duplicate_tab"),titleButtonPinTab=chrome.i18n.getMessage("title_button_pin_tab"),titleButtonUnPinTab=chrome.i18n.getMessage("title_button_unpin_tab"),titleButtonMoveTabToNewWindow=chrome.i18n.getMessage("title_button_move_tab_to_new_window"),titleButtonMoveToFirst=chrome.i18n.getMessage("title_button_move_to_first"),titleButtonMoveToLast=chrome.i18n.getMessage("title_button_move_to_last"),titleButtonListDomainDuplicates=chrome.i18n.getMessage("title_button_list_domain_duplicates"),textTabSuspended=chrome.i18n.getMessage("text_tab_suspended");let titleButtonSuspendTabFinal,titleButtonUnsuspendTabFinal,titleButtonControlListTab,titleButtonControlListDomain;async function updateSuspendButtonTitles(){isPremiumEnabled=await PopupCore.fetchPremiumState(),isPremiumEnabled?(titleButtonSuspendTabFinal=chrome.i18n.getMessage("title_button_suspend_tab"),titleButtonUnsuspendTabFinal=chrome.i18n.getMessage("title_button_unsuspend_tab")):(titleButtonSuspendTabFinal=chrome.i18n.getMessage("title_button_suspend_tab_supporters_only"),titleButtonUnsuspendTabFinal=chrome.i18n.getMessage("title_button_unsuspend_tab_supporters_only"))}function updateControlListButtonTitles(){Settings.listControlMode===ListControlMode.BLOCK_LIST?(titleButtonControlListTab=chrome.i18n.getMessage("title_button_block_list_tab"),titleButtonControlListDomain=chrome.i18n.getMessage("title_button_block_list_domain")):(titleButtonControlListTab=chrome.i18n.getMessage("title_button_allow_list_tab"),titleButtonControlListDomain=chrome.i18n.getMessage("title_button_allow_list_domain"))}function toHtml(tab){const tabPinTitle=tab.pinned?titleButtonUnPinTab:titleButtonPinTab,isSuspendable=Suspender.isSuspendableUrl(tab.url);return`\n        <div class="tab_item ${tab.suspended?"suspended":""} ${tab.pinned?"is_pinned":""}" data-url="${tab.url}" id="${tab.id}" data-id="${tab.id}" data-pinned="${tab.pinned}">\n            <div class="tab_item_pinned" title="${tab.pinned?titleTabPinnedTab:""}"></div>\n            <img class="tab_item_icon" src="${tab.icon}"/>\n            <div class="tab_item_title">${tab.title}</div>\n            <div class="tab_item_action_delete" data-id="${tab.id}" alt="${titleButtonCloseTab}" title="${titleButtonCloseTab}"></div>\n            <div class="tab_item_active_actions">\n            <div class="tab_item_url">${tab.suspended?`(${textTabSuspended}) `:""}${tab.url}</div>\n                <div class="tab_item_active_action_item ${tab.pinned?"is_pinned":""} ${isPremiumEnabled?"":"disabled"}" data-action="${TabActions.PIN}" data-pinned="${tab.pinned}" data-id="${tab.id}" alt="${tabPinTitle}" title="${tabPinTitle}"></div>\n                <div class="tab_item_active_action_item" data-action="${TabActions.DUPLICATE}" data-id="${tab.id}" alt="${titleButtonDuplicateTab}" title="${titleButtonDuplicateTab}"></div>\n                <div class="tab_item_active_action_item" data-action="${TabActions.LIST_DOMAIN_DUPLICATES}" data-url="${tab.url}" data-id="${tab.id}" alt="${titleButtonListDomainDuplicates}" title="${titleButtonListDomainDuplicates}"></div>\n                <div class="tab_item_active_action_item" data-action="${TabActions.ADD_TO_ALLOW_LIST}" data-id="${tab.id}" alt="${titleButtonControlListTab}" title="${titleButtonControlListTab}"></div>\n                <div class="tab_item_active_action_item" data-action="${TabActions.ADD_TO_ALLOW_LIST_DOMAIN}" data-id="${tab.id}" alt="${titleButtonControlListDomain}" title="${titleButtonControlListDomain}"></div>\n                <div class="tab_item_active_action_item ${tab.suspended||!isTGSinstalled?"hidden":""} ${isPremiumEnabled&&isSuspendable?"":"disabled"}" data-action="${TabActions.SUSPEND}" data-id="${tab.id}" alt="${titleButtonSuspendTabFinal}" title="${titleButtonSuspendTabFinal}"></div>\n                <div class="tab_item_active_action_item ${tab.suspended&&isTGSinstalled?"":"hidden"} ${isPremiumEnabled&&isSuspendable?"":"disabled"}" data-action="${TabActions.UN_SUSPEND}" data-id="${tab.id}" alt="${titleButtonUnsuspendTabFinal}" title="${titleButtonUnsuspendTabFinal}"></div>\n                <div class="tab_item_active_action_item" data-action="${TabActions.MOVE_WINDOW}" data-id="${tab.id}" alt="${titleButtonMoveTabToNewWindow}" title="${titleButtonMoveTabToNewWindow}"></div>\n                <div class="tab_item_active_action_item" data-action="${TabActions.MOVE_TO_FIRST}" data-id="${tab.id}" alt="${titleButtonMoveToFirst}" title="${titleButtonMoveToFirst}"></div>\n                <div class="tab_item_active_action_item" data-action="${TabActions.MOVE_TO_LAST}" data-id="${tab.id}" alt="${titleButtonMoveToLast}" title="${titleButtonMoveToLast}"></div>\n                <div class="tab_item_active_action_item_padder"></div>\n            </div>\n        </div>\n        `}function filterTabList(filterText,tabList,options){let filterIsSuspended=!1,filterNotSuspended=!1,filterIsPinned=null;if(options.premiumEnabled){const filterKeys=filterText.toLowerCase().split(" ");filterIsSuspended=filterKeys.includes("is:suspended"),filterNotSuspended=filterKeys.includes("-is:suspended"),filterIsPinned=!filterKeys.includes("-is:pinned")&&(!!filterKeys.includes("is:pinned")||null),(filterIsSuspended||filterNotSuspended)&&(filterText=filterText.replace(FILTER_REMOVE_KEY_SUSPENDED_REGEX,"$1 $3")),null!=filterIsPinned&&(filterText=filterText.replace(FILTER_REMOVE_KEY_PINNED_REGEX,"$1 $3"))}const filterRegexString=Utils.escapeRegex(filterText).split(" ").map((e=>`(?=.*${e})`)).join(""),FILTER_REGEX=new RegExp(filterRegexString,"i");return tabList.filter((tab=>!(!0===filterIsPinned&&!tab.pinned||!1===filterIsPinned&&tab.pinned)&&(!(filterIsSuspended&&!tab.suspended||filterNotSuspended&&tab.suspended)&&(FILTER_REGEX.test(tab.title)||FILTER_REGEX.test(tab.url))))).concat()}function filterList(filterText){const filteredList=filterTabList(filterText,tabList,{premiumEnabled:isPremiumEnabled}).map((tab=>tab.id));$(".tab_item").each(((i,el)=>{$(el)[filteredList.find((f=>f.toString()==el.id))?"show":"hide"]()}));null!=highlightedTabId&&$(`.tab_item#${highlightedTabId}:visible`).length>0||($(".tab_item.highlighted").removeClass("highlighted"),highlightedTabId=null),updateTabCount()}function filterItem(filterText,tab){const FILTER_REGEX=new RegExp(Utils.escapeRegex(filterText).split(" ").map((e=>`(?=.*${e})`)).join(""),"i"),show=FILTER_REGEX.test(tab.title)||FILTER_REGEX.test(tab.url);$(`#${tab.id}.tab_item`)[show?"show":"hide"](),$(".tab_item.highlighted").removeClass("highlighted");null!=highlightedTabId&&$(`.tab_item#${highlightedTabId}:visible`).length>0?$(".tab_item#"+highlightedTabId).addClass("highlighted"):highlightedTabId=null}function setFilterText(filterText){$("#tabSearch").val(filterText).trigger("input")}function updateTabCount(){const tabCount=$(".tab_item:visible").length;$("#tabs_count").text(1==tabCount?chrome.i18n.getMessage("text_tab_count_one"):chrome.i18n.getMessage("text_tab_count_other",tabCount+""))}function closeTab(){const tabId=$(".highlighted").attr("id");tabId&&chrome.tabs.get(parseInt(tabId),(tab=>{!chrome.runtime.lastError&&tab&&chrome.tabs.remove(tab.id,(()=>{navigateTabList(KeyboardTraverse.UP),removeTabsFromViewList([tab.id])}))}))}async function removeTabsFromViewList(tabIds){if(0==tabIds.length)return;const tabSelector=tabIds.map((t=>`#${t}`)).join(",");tabIds.includes(highlightedTabId)&&(highlightedTabId=null),await new Promise((resolve=>{$(tabSelector).removeClass("highlighted").fadeOut((()=>{$(tabSelector).remove(),resolve()}))}))}async function executeTabAction(e){e.preventDefault(),e.stopImmediatePropagation();const element=e.target,tabId=element.dataset.id?parseInt(element.dataset.id):chrome.tabs.TAB_ID_NONE;switch(element.dataset.action){case TabActions.DUPLICATE:{if(await MessageSender.sendMessage({type:MessageType.DUPLICATE_THIS_TAB,params:[tabId]}))return void window.close;const tL=await getList();return tabList=tL.concat(),void updateListView()}case TabActions.ADD_TO_ALLOW_LIST:{const url=$(`#${tabId}`).data("url");return void MessageSender.sendMessage({type:MessageType.ALLOWLIST_THIS_LINK,params:[{url:url}]})}case TabActions.ADD_TO_ALLOW_LIST_DOMAIN:{const url=$(`#${tabId}`).data("url");return void MessageSender.sendMessage({type:MessageType.ALLOWLIST_THIS_DOMAIN,params:[{url:url}]})}case TabActions.MOVE_WINDOW:return MessageSender.sendMessage({type:MessageType.MOVE_TO_NEW_WINDOW,params:[tabId]}),void window.close();case TabActions.SUSPEND:return void suspendTab(tabId);case TabActions.UN_SUSPEND:return void unsuspendTab(tabId);case TabActions.PIN:return void togglePinTab(tabId,"true"===element.dataset.pinned);case TabActions.MOVE_TO_FIRST:return void MessageSender.sendMessage({type:MessageType.MOVE_TO_FIRST,params:[tabId]});case TabActions.MOVE_TO_LAST:return void MessageSender.sendMessage({type:MessageType.MOVE_TO_LAST,params:[tabId]});case TabActions.LIST_DOMAIN_DUPLICATES:{const url=element.dataset.url;if(!url)return;return void setFilterText(Utils.getDomainFromUrl(url))}}}async function suspendTab(tabId){if(!isPremiumEnabled)return;null!=await Suspender.sendMessage({action:TgsActions.SUSPEND,tabId:tabId})?console.log("Error suspending by TGS. Maybe try force refresh."):console.debug("Successfully unsuspended")}async function unsuspendTab(tabId){if(!isPremiumEnabled)return;const response=await Suspender.sendMessage({action:TgsActions.UNSUSPEND,tabId:tabId});null!=response?console.log("Error suspending by TGS. Maybe try force refresh.",response):console.debug("Successfully unsuspended")}async function togglePinTab(tabId,wasPinned){if(!isPremiumEnabled)return;const id="string"==typeof tabId?parseInt(tabId):tabId;await new Promise((resolve=>chrome.tabs.update(id,{pinned:!wasPinned},resolve)));const tL=await getList();tabList=tL.concat(),updateListView()}function switchToHighlightedTab(){let tabId=$(".highlighted").attr("id");if(tabId||1!=$("#tab_host .tab_item:visible").length||(tabId=$("#tab_host .tab_item:visible:first").attr("id")),!tabId)return;const id=parseInt(tabId);MessageSender.sendMessage({type:MessageType.SWITCH_TO_TAB,params:[id,!0],fromPopup:!0}),window.close()}function navigateTabList(direction,toEnd=!1){let focusSearch=!1;const tabItems=$("#tab_host .tab_item:visible"),highlightedTabIndex=tabItems.index($(".highlighted"));$(".highlighted").removeClass("highlighted"),toEnd?tabItems.filter(direction===KeyboardTraverse.UP?":first":":last").addClass("highlighted"):-1==highlightedTabIndex?tabItems.filter(direction===KeyboardTraverse.UP?":last":":first").addClass("highlighted"):tabItems.length-1===highlightedTabIndex&&direction===KeyboardTraverse.DOWN||0===highlightedTabIndex&&direction===KeyboardTraverse.UP?focusSearch=!0:tabItems.filter(`:eq(${highlightedTabIndex+direction})`).addClass("highlighted"),highlightNavigated({focusSearch:focusSearch,direction:direction,toEnd:toEnd})}function navigateTabListByPage(direction){const height=$("main").height()*direction,tabItems=$("#tab_host .tab_item:visible"),highlightedTabIndex=tabItems.index($(".highlighted"));let newHighlightedTabIndex=highlightedTabIndex;$(".highlighted").removeClass("highlighted");let cumHeight=height*direction;return direction==KeyboardTraverse.DOWN?(tabItems.each(((i,el)=>{i<highlightedTabIndex||newHighlightedTabIndex!=highlightedTabIndex||(cumHeight-el.offsetHeight<0?newHighlightedTabIndex=i:cumHeight-=el.offsetHeight)})),newHighlightedTabIndex==highlightedTabIndex&&(newHighlightedTabIndex=tabItems.length-1)):($(tabItems.get().reverse()).each(((i,el)=>{i<tabItems.length-highlightedTabIndex||newHighlightedTabIndex!=highlightedTabIndex||(cumHeight-el.offsetHeight<0?newHighlightedTabIndex=tabItems.length-i:cumHeight-=el.offsetHeight)})),newHighlightedTabIndex==highlightedTabIndex&&(newHighlightedTabIndex=0)),tabItems.filter(`:eq(${newHighlightedTabIndex})`).addClass("highlighted"),0==newHighlightedTabIndex?highlightNavigated({direction:KeyboardTraverse.UP,toEnd:!0}):newHighlightedTabIndex==tabItems.length-1?highlightNavigated({direction:KeyboardTraverse.DOWN,toEnd:!0}):void highlightNavigated()}function navigateToHovered(){const tabItems=$("#tab_host .tab_item");$(".highlighted").removeClass("highlighted");const selectedTabIndex=tabItems.index($(".tab_item:hover"));tabItems.filter(`:eq(${selectedTabIndex})`).addClass("highlighted"),highlightNavigated()}function focusInBrowser(tabId){tabId&&MessageSender.sendMessage({type:MessageType.SWITCH_TO_TAB,params:[tabId,!1],fromPopup:!0})}function highlightNavigated(details={}){if(details.focusSearch)return $("#tabSearch").focus(),document.getElementsByTagName("main")[0].scrollTop=0,void(highlightedTabId=null);const highlighted=$(".highlighted")[0];highlightedTabId=highlighted.dataset.id,!isAttached&&highlighted&&(details.toEnd?document.getElementsByTagName("main")[0].scrollTop=details.direction===KeyboardTraverse.UP?document.getElementsByTagName("main")[0].clientHeight:document.getElementsByTagName("main")[0].scrollHeight:highlighted.scrollIntoViewIfNeeded(),$("#tabSearch").blur(),clearTimeout(hoverFocusTimer),hoverFocusTimer=setTimeout(focusInBrowser,100,parseInt(highlighted.id)))}function showSearchLabel(){$("#label_tab_search")[$("#tabSearch").val()?"hide":"show"]()}}();