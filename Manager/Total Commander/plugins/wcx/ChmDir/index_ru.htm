<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1251">
<title>Плагин CHMDir (WCX/WDX) для Total Commander</title>
<link rel="stylesheet" type="text/css" href="chmdir.css">
</head>

<body bgcolor="White">
<h1>Плагин CHMDir (WCX/WDX) для Total Commander</h1>

<p align="right" style="font-size: smaller;"><a href="index_en.htm">Switch to English</a></p>

Версия 0.40 beta 7 для 32-разрядной версии <a href="http://www.ghisler.com/">Total Commander</a>.
Используйте на свой страх и риск.
Если вы обновляете плагин, стоит посмотреть раздел
<a href="#history">История версий</a>.

<p>Тестировался с Total Commander 6.51&ndash;6.53 (32 бит) под w2k rus.

<p>Хотелось бы, чтобы программа была полезной, однако, НИКАКИХ ГАРАНТИЙ,
ПОДДЕРЖКИ и всё такое...

<p>Соображения по поводу плагина можно высказать <a href="#author">автору</a>.

<p>CHMlib, CHMtools и библиотека сжатия LZX Copyright 2001 Matthew T. Russotto &mdash;
<a href="http://www.speakeasy.org/~russotto/">http://www.speakeasy.org/~russotto/</a>.

<p>В CHMDir использована информация с сайта Paul Wise aka pabs &mdash;
<a href="http://pabs.zip.to">http://pabs.zip.to</a> и немного кода из
<a href="http://www.info-zip.org/pub/infozip/">Info-ZIP</a> (файл <code>match.c</code>).

<P>
<hr>
<ul>
	<li><a href="#about">О плагине</a>
	<li><a href="#files">Файлы в архиве</a>
	<li><a href="#install_wcx">Установка плагина</a>
	<ul>
		<li><a href="#install_wcx">Как архиваторного (WCX)</a>
		<li><a href="#install_wdx">Как информационного (WDX)</a>
	</ul>
	<li><a href="#ini_file">CHMDir.ini &mdash; настройки</a>
	<li><a href="#CHMView">CHMView.exe</a>
	<li><A HREF="#wtedit">wtedit.exe и wtdump.exe</A>
	<li><a href="#UnCHMw">UnCHMw.exe</a>
	<li><a href="#new">Новые версии</a>
	<li><a href="#make">Компиляция</a>
	<li><a href="#author">Автор</a>
	<li><a href="#history">История версий</a>
</ul>

<hr>


<a name="about"></a>
<H2>О плагине</H2>

<p>CHMDir добавляет в Total Commander поддержку файлов формата
<a href="http://www.speakeasy.org/~russotto/">ITSS/CHM</a> (компилированный HTML),
позволяя распаковывать и искать файлы в архиве, а также упаковывать и удалять файлы.

<p>Плагин позволяет распаковывать файлы HtmlHelp 2 (<code>.Hx?</code>).

<p>Кроме того, он может работать и как информационный плагин, предоставляя информацию
о заголовке окна справки, компиляторе и времени компиляции.

<p>Наличие Internet Explorer`а в системе не требуется.

<blockquote>
<strong>NB</strong>: Плагин не может создавать полноценные CHM-ы с содержанием, индексом и
т.д., но его достаточно для того, чтобы сделать CHM из скачанного сайта, если
среди упаковываемых файлов есть хотя бы один файл с расширением .htm или .html.
Для примера можно перепаковать этот архив в CHM. Для создания полноценного
файла справки HtmlHelp можно использовать
<A HREF="http://msdn.microsoft.com/workshop/author/htmlhelp/">HTML Help Workshop</A>
или <a href="http://yarix.by.ru/">htm2chm</a>.
</blockquote>

<p>Если файлы пакуются в новый архив, и в корне будущего архива нет файла
'#SYSTEM', то он будет создан. В качестве главной страницы будет взят первый
встретившийся файл из '<CODE>default_topics</CODE>' (см. <a href="#ini_file">CHMDir.ini</a>),
а, если такового нет, то первый
встретившийся файл с расширением '.htm' или '.html'. Если в списке на
добавление нет файла содержания (.hhc), то он тоже будет создан с именем
'stub.hhc'. В этом файле будут перечислены все .htm*, .php-файлы с
подкаталогами в том порядке, в каком они перечислены в списке на добавление.
Т.е. их порядок с содержании зависит от сортировки, принятой в TC.

<p>Для сохранения структуры файла перед перепаковкой он должен быть распакован с
включенной опцией 'Показывать файлы CHM'
(<a href="#ini_file">CHMDir.ini</a> или диалог настроек),
чтобы сохранить файлы типа '#SYSTEM'
(в нем указана такая информация как заголовок окна справки, имя файла
содержания и проч.).


<a name="files"></a>
<H2>Файлы в архиве</H2>

<table cellpadding="0" cellspacing="0" align="center">
	<tr><td><A HREF="File_Id.diz">File_Id.diz</A></td>  <td width="20"></td>
		<td>краткое описание пакета</td></tr>
	<tr><td><A HREF="index_en.htm">index_en.htm</A></td>          <td></td>
		<td>описание пакета на английском</td></tr>
	<tr><td><strong>index_ru.htm</strong></td><td></td>
		<td>то же, что и выше, на русском (вы это читаете)</td></tr>
    <tr><td><A HREF="chmdir.css">chmdir.css</A></td><td></td>
        <td>Таблица стилей для <SAMP>index_*.htm</SAMP></td></tr>
	<tr><td><A HREF="pluginst.inf">pluginst.inf</A></td><td></td>
		<td>INF-файл для автоматической установки плагина</td></tr>
	<tr><td><A HREF="CHMDir.wcx">CHMDir.wcx</A></td>    <td></td>
		<td>собственно плагин</td></tr>
	<tr><td><A HREF="sample.ini">sample.ini</A></td>    <td></td>
		<td>примерный INI-файл плагина</td></tr>
    <tr><td><A HREF="chmdir.lng">chmdir.lng</A></td>    <td></td>
        <td>языковой файл для информационного плагина</td></tr>
	<tr><td><A HREF="CHMView.exe">CHMView.exe</A></td>  <td></td>
		<td>программа для просмотра файлов CHM без <samp>hh.exe</samp></td></tr>
	<tr><td><A HREF="UnCHMw.exe">UnCHMw.exe</A></td>    <td></td>
		<td>консольная версия распаковщика</td></tr>
	<tr><td><a href="wtdump.exe">wtdump.exe</a></td>    <td></td>
		<td>консольная программа для вывода свойств окна HtmlHelp</td></tr>
	<tr><td><a href="wtedit.exe">wtedit.exe</a></td>    <td></td>
		<td>программа для редактирования свойств окна HtmlHelp</td></tr>
    <tr><td><a href="descript.ion">descript.ion</a></td>    <td></td>
        <td>описания файлов</td></tr>
</table>


<a name="install_wcx"></a>
<h2>Установка плагина как WCX</h2>

<ol>
	<li>Распаковать файл <code>chmdir.wcx</code> в каталог по желанию.
	<li>В TC выбрать <em>Конфигурация/Настройка...</em> и открыть страницу <em>Плагины</em>
	<li>Нажать <em>Настройка</em> архиваторных плагинов (.WCX)
	<li>Добавить расширение '<code>chm</code>'
	<li>Нажать <em>Обзор...</em>и найти распакованный <code>chmdir.wcx</code>
	<li>Нажать <em>OK</em>
	<li>Шаги с 4-го по 6-ой повторить для расширения <code>.hxs</code>
	<li>При необходимости создать в каталоге с плагином файл <a href="#ini_file">CHMDir.ini</a>
		или скопировать из <code>sample.ini</code>.
</ol>

<blockquote>
<strong>NB</strong>:
Иконка файлов и действие по умолчанию (по нажатию &lt;Enter&gt;) не изменятся.
Для входа в архив нужно использовать сочетание &lt;Ctrl-PgDn&gt;. При желании
входить в архив при помощи клавиши &lt;Enter&gt; и показывать у файла иконку архива
нужно сделать следующее:

<ol>
    <li>В главном меню выбрать <EM>Конфигурация/Настройка...</EM> и открыть страницу
        <EM>Архиваторы</EM>, в которой нажать кнопку <EM>Настройка</EM> архиваторных плагинов.
	<li>В выпадающем списке 'Файлы с расширением' выбрать 'chm'.
	<li>В поле 'Открывать с помощью программы:' заменить число <em>NNN</em> перед
		запятой на <em>MMM</em>, где <em>MMM</em>=<em>NNN</em>-256.
</ol>

<p>или

<ol>
	<li>Закрыть Total Commander
    <li>Открыть INI-файл Total Commander`а (обычно <CODE>&lt;каталог_windows&gt;\WINCMD.INI</CODE>)
		в текстовом редакторе.
	<li>В секции <code>[PackerPlugins]</code> изменить <em>NNN</em> в строке, похожей на
		'<code>chm=NNN,C:\wincmd\chmdir.wcx</code>' на <em>MMM</em>, где <em>MMM</em>=<em>NNN</em>-256.

</ol>

<p>Для просмотра CHM-файла можно использовать:

<ul>
    <li>команду <SAMP>hh &lt;chm-file&gt;</SAMP>,
	<li>сочетание &lt;Ctrl-Enter&gt; для вставки имени файла в командную строку, а
		затем &lt;Enter&gt; для запуска ассоциированной программы (hh.exe),
	<li>правый клик на имени файла и действие по умолчанию (выделено полужирным
		шрифтом).
</ul>
</blockquote>

<a name="install_wdx"></a>
<h2>Установка плагина как WDX</h2>
<ol>
    <li>Выбрать <EM>Конфигурация/Настройка</EM>
    <li>Выбрать страничку <CODE>Плагины</CODE> и в группе <EM>Информационные плагины</EM> нажать
        <EM>Настройка</EM>.
    <li>В диалоговом окне 'Информационные плагины' нажать кнопку <EM>Добавить</EM> и в
        поле 'Имя файла' ввести '<SAMP>*.wcx</SAMP>'.
	<li>Найти распакованный CHMDir.wcx и нажать 'Открыть'.
</ol>


<a name="ini_file"></a>
<h2>CHMDir.ini</h2>

<p>При загрузке плагин считывает настройки из файла <code>CHMDir.ini</code>,
стандартного <em>ini</em>-файла Windows,
который должен находиться в одном с плагином каталоге.

<P>Описание см. в файле <A HREF="sample.ini">sample.ini</A>.

<p>Чтобы изменения вступили в силу, нужно либо перезапустить TC, либо выгрузить
все плагины и зайти в другой CHM (TC помнит список файлов последнего архива).


<h2>Известные ошибки и ограничения</h2>
<ul>
	<li>Плагин использует для распаковки CHMTools, которые работают только с
		версией 3 CHM. (Правда, я других и не встречал пока).
	<li>Плагин использует оперативную память для хранения списка файлов в CHM.
		Поэтому, если имеется файл, в котором упакованы 1000 файлов со средней длиной
		имени 100 байт, то для распаковки нужно дополнительно иметь порядка 0,5 Мб
		доступной оперативной памяти.
	<li>Плагин не разрабатывался, и не будет работать с файлами &gt;= 2 Gb.
</ul>


<a name="CHMView"></a>
<h2>CHMView.exe</h2>

<p>Программа предназначена для просмотра CHM-файлов без участия hh.exe. В
качестве параметра ей нужно передать имя файла CHM. CHMView распакует этот
файл во временный каталог и попытается запустить зарегистрированный
просмотрщик HTML.


<a name="wtedit"></a>
<a name="wtdump"></a>
<h2>wtedit.exe и wtdump.exe</h2>

<P><STRONG>wtdump.exe</STRONG> выводит свойства окна HtmlHelp (или свойства по умолчанию
для текущего каталога) и примерный <em>HHP</em>-файл (файл проекта HtmlHelp), который можно использовать
для создания такого файла справки.

<P><STRONG>wtedit.exe</STRONG> позволяет редактировать свойства окна HtmlHelp для файла,
переданного в качестве параметра программы.

<P>Для работы обеих программ необходимо, чтобы файл <code>CHMDir.wcx</code> находился в одном с ними
каталоге или в каталоге, указанном в переменной окружения '<code>PATH</code>'.

<P>Более подробно см.
<A HREF="http://msdn.microsoft.com/workshop/author/htmlhelp/">HTML Help Web page</A>
или <EM>Help for HTML Help</EM> из <EM>HTML Help Workshop</EM>.


<a name="UnCHMw"></a>
<h2>UnCHMw.exe</h2>

<p>Эта программа &mdash; версия распаковщика с интерфейсом командной строки.

<p><STRONG>UnCHMw.exe</STRONG> использует настройки из <a href="#ini_file">CHMDir.ini</a>.


<a name="new"></a>
<h2>Новые версии</h2>

<p>См. <a href="http://wincmd.ru/plugring/chmdir.html">http://wincmd.ru/plugring/chmdir.html</a>


<a name="make"></a>
<h2>Компиляция</h2>

<p>Отредактировать <code>Makefile</code>, создать каталог 'obj' и запустить 'Nmake.exe'.


<a name="author"></a>
<h2>Автор</h2>

<p>Олег Бондарь aka Hobo (<code>hobo-mts at mail pnt ru</code>).
Заменить 'at' на 'собаку', а 'pt' на '.'.

<p>В теме письма должно присутствовать слово '<samp>CHMDir</samp>'.


<a name="history"></a>
<h2>История версий</h2>

<h3>0.40 beta 7 (2005/??/??)</h3>
<ul>
	<LI>Добавлены свойства окна HtmlHelp.
	<LI>CHMView: добавлены диалоги прогресса.
	<li>Добавлены wtdump.exe и wtedit.exe.
    <LI>Добавлен UnCHMw.exe.
    <LI>Добавлено конвертирование кодовой страницы для тега &lt;TITLE&gt;.
    <LI>В информационный плагин добавлено поле кодовой страницы / языка.
</ul>

<h3>0.40 beta 6 (2005/06/23)</h3>
<ul>
	<li>Добавлена кнопка добавления имени файла топика по умолчанию.
	<li>В диалоге конфигурации 'Код размера окна LZX' изменено на 'Размер окна LZX'.
	<li>Добавлена упаковка при помощи COM-интерфейса IStorage.
	<li>Добавлена функциональность информационного плагина (WDX).
</ul>

<h3>0.40 beta 5:</h3>
<ul>
	<li>Добавлена распаковка файлов .HxS.
	<li>Расширен stub.hhc.
	<li>Добавлен параметр INI-файла title_stub.
</ul>

<h3>0.40 beta 4:</h3>
<ul>
	<li>Исправлена досадная ошибка в заголовке файла (размер структуры),
		которая прокралась в код по недосмотру. Спасибо BootROM`му за содействие.
	<li>Добавлена возможность установки низкого приоритета на время упаковки.
</ul>

<h3>0.40 beta 3:</h3>
<ul>
	<li>CHMView не распаковывал CHM-ы с каталогами, в которых находятся только подкаталоги.
	<li>Щелчок на кнопке 'Не сжимать расш.' разрешает или запрещает следующее поле ввода.
	<li>'=.gif' теперь распаковывается как '=.gif', а не как '_.gif'.
	<li>Подправлена сортировка файлов в листинге CHM-а.
</ul>

<h3>0.40 beta 2:</h3>
<ul>
	<li>Переписан код записи листинга.
	<li>В INI-файл добавлены параметры упаковки.
	<li>Добавлена сортировка файлов по расширению до упаковки и вычисление размера чанка листинга.
	<li>Добавлена генерация информации HtmlHelp.
	<li>Добавлены параметры INI-файла: calc_chunk_size, its_use_store, default_topics, sort_dir_by_ext.
	<li>Добавлен диалог настройки.
	<li>Добавлен index.htm.
</ul>

<h3>0.40 beta 1:</h3>
<ul>
	<li>Код чтения листинга и распаковки полностью переписан &mdash; значительно
		уменьшена потребность в оперативной памяти (особенно для CHM, в которых
		есть большие файлы), немного увеличилась производительность.
	<li>Добавлено кэширование данных CHM-ов.
	<li>Добавлены функции  PackFiles(), DeleteFiles() и ConfigurePacker().
		Изменены свойства плагина. GetPackerCaps() теперь возвращает 479. Если
		плагин раньше использовался, его нужно переконфигурировать (см. выше).
</ul>

<h3>0.30a:</h3>
<ul>
	<li>Добавлена функция PackSetDefaultParams() (пока только заглушка и только в
		качестве комментария &mdash; плагин инициализируется во время загрузки при
		вызове DllMain() &mdash; это, конечно, неправильно, но пользователь не знает,
		какой INI-файл используется, а плагин не может ему этого сообщить: все
		настройки делаются вручную правкой INI-файла).
</ul>

<h3>0.30:</h3>
<ul>
	<li>Добавлена функция CanYouHandleThisFile() для открытия файлов с расширением
		не .chm. GetPackerCaps() теперь возвращает 452.
	<li>В дистрибутив вновь добавлен CHMView.exe.
</ul>

<h3>0.29 beta:</h3>
<ul>
	<li>Добавлен INI-файл.
	<li>Значительно уменьшена потребность в оперативной памяти.
	<li>Убраны make-файлы для Watcom и lcc-Win32.
</ul>

<h3>0.28 beta:</h3>
<ul>
	<li>Не показываются в списке файлы, чьи имена начинаются с '#' и '$'.
	<li>Символ '_' используется для замены символов, которые не могут быть
		отображены в текущей кодовой странице при использовании функции
		WideCharToMultiByte(). Не тестировалось по причине отсутствия таких файлов.
	<li>Ещё один клюдж для распаковки файлов, созданных htm2chm.
</ul>

<h3>0.27 beta:</h3>
<ul>
	<li>Добавлена обработка результата, возвращаемого ProcessDataProc() &mdash; работает
		кнопка отмены.
	<li>Исправлена ошибка, вызывавшая сбой при открытии CHM-ов, содержащих
		дли-и-инные имена файлов.
</ul>

<h3>0.26 beta:</h3>
<ul>
	<li>Добавлено декодирование имён файлов из UTF-8.
</ul>

<h3>0.24 beta:</h3>
<ul>
	<li>Добавлена информация о CHMView.
	<li>Время последнего изменения файлов в архиве == времени CHM-файла.
	<li>Добавлена информация о версии.
</ul>

<h3>0.23 beta:</h3>
<ul>
	<li>Возврат к одному файлу без дополнительной DLL.
	<li>Исправлена ошибка с освобождением памяти в chmdir.
	<li>ЗАЛАТАНА (надеюсь) &mdash; не исправлена &mdash; [ошибка] в chmlib Matthew T.
		Russotto, которая вызвала нарушение при обращении к памяти. См.
		комментарий со словами <code>'!!! Hobo'</code>.
	<li>Добавлен файл READMEru.txt &mdash; на русском языке.
	<li>Название архива изменено на wcx_chmdirX.XX.zip. Где X.XX &mdash; номер версии.
</ul>

<h3>0.22 beta:</h3>
<ul>
	<li>Очередная попытка сделать работу плагина стабильной.
		chmlib Matthew T. Russotto перенесена в отдельную DLL,
		которая загружается и выгружается при каждом открытии архива &mdash;
		может, это немного сэкономит память.

	<p>Ничего не получилось. :-(

</ul>

<h3>0.21 beta:</h3>
<ul>
	<li>Добавлена функция GetPackerCaps().
</ul>

<h3>0.20 beta:</h3>
<ul>
	<li>Первый выход в свет.
</ul>

</body>
</html>