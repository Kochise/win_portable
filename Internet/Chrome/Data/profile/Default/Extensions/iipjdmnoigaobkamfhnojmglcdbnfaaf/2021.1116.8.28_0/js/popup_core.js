const PopupCore=function(){let premiumEnabled=!1,searchParam=location.search.substr(1);const urlParams=Utils.parseQuery(searchParam);let theme=urlParams&&urlParams.theme?urlParams.theme:DefaultSettings.CF_WINDOW_THEME;const isAttached=urlParams&&urlParams.attached;function switchTheme(newTheme){applyTheme(newTheme);const oldTheme=theme;theme=newTheme,$("#switchThemeLink").text(getNextThemeName(theme)),searchParam=searchParam.replace(oldTheme,theme)}function applyTheme(theme){let appliedTheme=theme==Theme.DARK?AppliedTheme.DARK:AppliedTheme.LIGHT;theme==Theme.SYSTEM&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(appliedTheme="apply_dark"),$("body").removeClass(`${AppliedTheme.DARK} ${AppliedTheme.LIGHT}`).addClass(appliedTheme)}isAttached&&document.getElementsByTagName("html")[0].classList.add("attached"),$((()=>{$("#version_span").text(`ver ${chrome.runtime.getManifest().version_name}`),$("#switchThemeLink").text(getNextThemeName(theme)),$("#support_card, #support_footer").hide(),fetchPremiumState().then((()=>{premiumEnabled?($("#support_card, #support_footer").hide(),$("#version_span").addClass("supporter"),$("#thanks_card").show()):($("#support_card, #support_footer").show(),$("#thanks_card").hide())})),$(".footer_link").on("click",(e=>{switch(e.currentTarget.id){case"version_span":{const url=e.currentTarget.dataset.href;chrome.tabs.create({url:url||Urls.UPDATE_NOTES});break}case"support_footer":chrome.tabs.create({url:Urls.OPTIONS+OptionsSectionReference.SUPPORT});break;case"feedback_link":Utils.getFeedbackUrl(premiumEnabled).then((feedbackUrl=>chrome.tabs.create({url:feedbackUrl})));break;case"c306_apps":{const url=e.currentTarget.dataset.href;url&&chrome.tabs.create({url:url});break}default:return}return e.preventDefault(),!1})),$(".header_item").on("click",(e=>{const classList=e.currentTarget.classList;if(classList.contains("selected")||classList.contains("disabled"))return!1;switch(e.currentTarget.id){case"tabs_header":location.href=`${Urls.POPUP.TAB_SEARCH}?${searchParam}`;break;case"duplicates_header":location.href=`${Urls.POPUP.DUPLICATES}?${searchParam}`;break;case"tools_header":location.href=`${Urls.POPUP.ACTIONS}?${searchParam}`}})),$(document).keypress((e=>{const character=e.key;if(e.ctrlKey)if(/[1-3]/.test(character))switch(parseInt(character)){case 1:$("#tabs_header").click();break;case 2:$("#duplicates_header").click();break;case 3:$("#tools_header").click()}else if(e.which==KEYCODE.TAB){switch($(".header_item.selected").attr("id")){case"tabs_header":e.shiftKey?$("#tools_header").click():$("#duplicates_header").click();break;case"duplicates_header":e.shiftKey?$("#tabs_header").click():$("#tools_header").click();break;case"tools_header":e.shiftKey?$("#duplicates_header").click():$("#tabs_header").click()}}})),$("#switchThemeLink").on("click",(e=>{if("switchThemeLink"!==e.currentTarget.id)return;const newTheme=(currentTheme=theme)==Theme.LIGHT?Theme.DARK:currentTheme==Theme.DARK?Theme.SYSTEM:Theme.LIGHT;var currentTheme;Settings.cfWindowTheme=newTheme,switchTheme(newTheme)})),window.matchMedia&&(window.matchMedia("(prefers-color-scheme: dark)").onchange=()=>applyTheme(theme))})),chrome.storage.onChanged.addListener((async changes=>{await Settings.onChanged(changes),changes.hasOwnProperty("cfWindowTheme")&&changes.cfWindowTheme.hasOwnProperty("newValue")&&switchTheme(changes.cfWindowTheme.newValue)}));const themeMessageDark=chrome.i18n.getMessage("text_action_use_theme_dark"),themeMessageLight=chrome.i18n.getMessage("text_action_use_theme_light"),themeMessageSystem=chrome.i18n.getMessage("text_action_use_theme_system");function getNextThemeName(currentTheme){return currentTheme==Theme.LIGHT?themeMessageDark:currentTheme==Theme.DARK?themeMessageSystem:themeMessageLight}async function fetchPremiumState(){return premiumEnabled=await MessageSender.sendMessage({type:MessageType.GET_IS_SUPPORTER}),premiumEnabled}let resizeTimeout;isAttached||(window.addEventListener("resize",(function(){resizeTimeout||(resizeTimeout=setTimeout((function(){resizeTimeout=null,function(){if(winH==window.innerHeight&&winW==window.innerWidth)return;winH=window.innerHeight,winW=window.innerWidth,Settings.popup_size={h:winH,w:winW,x:winX,y:winY}}()}),1e3))}),!1),setInterval((function(){if(winX==window.screenX&&winY==window.screenY)return;winX=window.screenX,winY=window.screenY,Settings.popup_size={h:winH,w:winW,x:winX,y:winY}}),1e3));let winX=window.screenX,winY=window.screenY,winH=window.innerHeight,winW=window.innerWidth;return{fetchPremiumState:fetchPremiumState,showHelp:function(show){return $("#helpModal")[show?"show":"hide"](),show}}}(),Toast=function(){let toastActionCallback,toastCallback,toastTimer;const DURATION={SHORT:2e3,LONG:3500,WITH_ACTION:5e3,INDEFINITE:-1};function hideToast(from="hide_from_on_new_toast"){"hide_from_on_action"!==from&&toastCallback&&"function"==typeof toastCallback&&toastCallback(),toastCallback=null,"hide_from_on_action"==from&&toastActionCallback&&"function"==typeof toastActionCallback&&toastActionCallback(),toastActionCallback=null,clearToast({fadeOut:"hide_from_on_callback"==from})}function clearToast(options){var _a,_b;const fadeOut=null!==(_a=null==options?void 0:options.fadeOut)&&void 0!==_a?_a:null!=(null==options?void 0:options.speed),speed=null!==(_b=null==options?void 0:options.speed)&&void 0!==_b?_b:"slow";toastTimer&&(clearTimeout(toastTimer),toastTimer=void 0),fadeOut?$("#toastOuter").fadeOut(speed):$("#toastOuter").hide()}return{showToast:function(toast){toast&&toast.text?(hideToast(),toast.duration=toast.duration?toast.duration:toast.action?DURATION.WITH_ACTION:DURATION.SHORT,toast.onHide=toast.onHide||console.debug,$("#toastText").text(toast.text),toast.action?($("#toastAction").text(toast.action.text),toastActionCallback=toast.action.onAction,$("#toastAction").on("click",(()=>hideToast("hide_from_on_action")))):($("#toastAction").text(""),toastActionCallback=null,$("#toastAction").off("click")),toastCallback=toast.onHide,$("#toastOuter").fadeIn(),toast.duration!=DURATION.INDEFINITE&&(toastTimer=setTimeout(hideToast,toast.duration,"hide_from_on_callback"))):console.debug("Empty toast!")},doUndo:function(){hideToast("hide_from_on_action")},clear:clearToast,DURATION:{SHORT:DURATION.SHORT,LONG:DURATION.LONG,INDEFINITE:DURATION.INDEFINITE}}}();